<!doctype html>
<html>
<head><meta charset="utf-8"><title>Plaid Link - Chase</title></head>
<body>
  <button id="open">Connect JPMorgan Chase</button>
  <pre id="out" style="white-space:pre-wrap"></pre>

  <script src="https://cdn.plaid.com/link/v2/stable/link-initialize.js"></script>
  <script>
    // paste the NEW token from step 2
    const LINK_TOKEN = "link-production-ece83f0e-0290-4641-8155-af6eada4da6e";

    const out = document.getElementById('out');

    function log(msg) {
      console.log(msg);
      out.textContent += (out.textContent ? "\n" : "") + msg;
    }

    // are we on the OAuth return?
    const params = new URLSearchParams(window.location.search);
    const isOAuthReturn = params.has('oauth_state_id');

    const config = { token: LINK_TOKEN };
    if (isOAuthReturn) {
      // ONLY on return
      config.receivedRedirectUri = window.location.href;
      log("Detected OAuth return, finishing Link…");
    } else {
      log("Click the button to start Chase…");
    }

    const handler = Plaid.create({
      ...config,
      onSuccess(public_token, metadata) {
        log("public_token: " + public_token +
            "\n\nmetadata:\n" + JSON.stringify(metadata, null, 2) +
            "\n\nRun the public_token exchange next.");
      },
      onExit(err) {
        if (err) log("Exit: " + (err.error_message || JSON.stringify(err)));
      }
    });

    document.getElementById('open').onclick = () => {
      handler.open();
    };
  </script>
</body>
</html>
